<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>Flaggsr</title>
    <link rel="stylesheet" href="style.css"></link>
</head>
<body>
    <div>
        <h1 id="titleLabel"></h1>
        <h3 id="score" position >Score: </h3>

        <button id="returnButton" style="position: fixed; bottom: 10px; left: 10px;">Return</button>
        <button id="muteButton">
            <img id="muteImage" src="sound/sound.png" alt="Sound">
        </button>
        <button id="easyMode" style="position: fixed; bottom: 10px; right: 10px;">EasyMode</button>        
    </div>
    <div id="imageContainer">
        <img src="w2560/ad.png" alt="Your Image" id="mainImage">
        <input type="text" id="inputBox" placeholder="Which country?">
        <button id="btn1" style="display: none;">a</button>
        <button id="btn2" style="display: none;">a</button>
        <button id="btn3" style="display: none;">a</button>
        <button id="btn4" style="display: none;">a</button>
    <script src="return.js"></script>   
    <script src="hashMap.js"></script>
    <script src="handleInput.js"></script>

    <script>
        let land = "";
        let modul = 0;
        let teller = 0;
        let hS = 0;
        let besoekt;
        let fullLandListe;
        let total = 0;
        let isEasy = false;
        let newInput;
        let randomButton;

        const correct = new Audio("sound/correct.mp3");
        const wrong = new Audio("sound/wrong.mp3");
        const win = new Audio("sound/win.mp3");

        document.addEventListener("DOMContentLoaded", function() {
            const urlParams = new URLSearchParams(window.location.search);
            const buttonPressed = urlParams.get("button");
            let a = document.getElementById("titleLabel");

            if (buttonPressed === "World") {
                besoekt = new Map(countryFlagMap);
                fullLandListe = new Map(countryFlagMap);
                setRandomInitialImage();
                a.textContent="World";
            }
            else if (buttonPressed === "Europe") {
                modul = 1;
                besoekt = new Map(euFlagMap);
                fullLandListe = new Map(euFlagMap);
                setRandomInitialImageEu();
                a.textContent="Europe";
            }
            else if (buttonPressed === "Africa") {
                modul = 2;
                besoekt = new Map(afFlagMap);
                fullLandListe = new Map(afFlagMap);
                setRandomInitialImageAf();
                a.textContent="Africa";
            }
            else if (buttonPressed === "Asia") {
                modul = 3;
                besoekt = new Map(asFlagMap);
                fullLandListe = new Map(asFlagMap);
                setRandomInitialImageAs(); 
                a.textContent="Asia";
            }
            else if (buttonPressed === "America") {
                modul = 4;
                besoekt = new Map(amFlagMap);
                fullLandListe = new Map(amFlagMap);
                setRandomInitialImageAm();
                a.textContent="America";
            }
            let inp = document.getElementById("inputBox");
            setTimeout(() => window.scrollTo(0, 100));
            inp.addEventListener("focus", () => {
            inp.style.opacity = 0;
            setTimeout(() => inp.style.opacity = 1);
            });


            b1 = document.getElementById("btn1");
            b2 = document.getElementById("btn2");
            b3 = document.getElementById("btn3");
            b4 = document.getElementById("btn4");
            randomButton = [b1, b2, b3, b4][Math.floor(Math.random() * 4)];
            randomButton.innerText = land;
            let liste = new Array();
            if(b1.textContent === "a"){
                b1.textContent = getRandomFullListe().country;
                liste.push(b1.textContent);
            }
            if(b2.textContent === "a"){
                    b2.textContent = getRandomFullListe().country;
                while(liste.includes(b2.textContent) || b2.textContent === land){
                    b2.textContent = getRandomFullListe().country;
                }
                liste.push(b2.textContent);
            }
            if(b3.textContent === "a"){
                b3.textContent = getRandomFullListe().country;
                while(liste.includes(b3.textContent) || b3.textContent === land){
                    b3.textContent = getRandomFullListe().country;
                }
                liste.push(b3.textContent);
            }
            if(b4.textContent === "a"){
                b4.textContent = getRandomFullListe().country;
                while(liste.includes(b4.textContent) || b4.textContent === land){
                    b4.textContent = getRandomFullListe().country;
                }
            }

            b1.addEventListener("click", knapp);
            b2.addEventListener("click", knapp);
            b3.addEventListener("click", knapp);
            b4.addEventListener("click", knapp);

            total = besoekt.size;
            document.getElementById("imageContainer").style.display = "flex";
            document.getElementById("score").removeAttribute("hidden");
            document.getElementById("score").textContent = "Score: " + teller + "/" + total;
            document.getElementById("inputBox").focus();
            });

        function updateScore(bool){
            if(bool === true){
                let scoreElement = document.getElementById("score");
                scoreElement.textContent = "Score: " + teller + "/" + total;
            } else {
                teller = 0;
                let scoreElement = document.getElementById("score");
                scoreElement.textContent = "Score: " + teller + "/" + total;
            }
        }
        function showCongratulationsMessage() {
        // Create a <div> element to hold the message
            const congratulationsDiv = document.createElement("div");
            congratulationsDiv.className = "congratulations-message"; // You can style this class in your CSS

            // Create the message text
            const messageText = document.createElement("p");
            messageText.textContent = "Congratulations!";
            
            // Append the message text to the <div>
            congratulationsDiv.appendChild(messageText);
            win.play();
            // Append the <div> to the document body or any other appropriate container
            document.body.appendChild(congratulationsDiv);
        }

        document.getElementById("inputBox").addEventListener("keydown", handleInput);
    
        // Function to handle input changes and check for expected values
        

        function getRandom() {
            let keys = Array.from(besoekt.keys());
            let randomIndex = Math.floor(Math.random() * keys.length);
            let randomCountry = keys[randomIndex];
            let randomFlag = besoekt.get(randomCountry);
            return { country: randomCountry, flag: randomFlag };
        }
        function getRandomFullListe() {
            let keys = Array.from(fullLandListe.keys());
            let randomIndex = Math.floor(Math.random() * keys.length);
            let randomCountry = keys[randomIndex];
            let randomFlag = besoekt.get(randomCountry);
            return { country: randomCountry, flag: randomFlag };
        }
        
        function setRandomInitialImage() {
            const imageElement = document.getElementById("mainImage");
            const randomPair = getRandomCountryFlag(); 
            const randomFlag = randomPair.flag;
            const randomCountry = randomPair.country;
            land = randomCountry;
            imageElement.src = randomFlag;
            besoekt.delete(randomCountry);
    }
        function setRandomInitialImageEu() {
            const imageElement = document.getElementById("mainImage");
            const randomPair = getRandomEuropeFlag(); 
            const randomFlag = randomPair.flag;
            const randomCountry = randomPair.country;
            land = randomCountry;
            imageElement.src = randomFlag;
            besoekt.delete(randomCountry);
    }
        function setRandomInitialImageAf() {
            const imageElement = document.getElementById("mainImage");
            const randomPair = getRandomAfricanFlag(); 
            const randomFlag = randomPair.flag;
            const randomCountry = randomPair.country;
            land = randomCountry;
            imageElement.src = randomFlag;
            besoekt.delete(randomCountry);
    }
        function setRandomInitialImageAs() {
            const imageElement = document.getElementById("mainImage");
            const randomPair = getRandomAsianFlag(); 
            const randomFlag = randomPair.flag;
            const randomCountry = randomPair.country;
            land = randomCountry;
            imageElement.src = randomFlag;
            besoekt.delete(randomCountry);
    }
        function setRandomInitialImageAm() {
            const imageElement = document.getElementById("mainImage");
            const randomPair = getRandomAmericanFlag(); 
            const randomFlag = randomPair.flag;
            const randomCountry = randomPair.country;
            land = randomCountry;
            imageElement.src = randomFlag;
            besoekt.delete(randomCountry);
    }

    function knapp(){
        if(this.textContent === land){
            correct.play();
            teller += 1;
            let randomFlag = "";
            let randomCountry = "";
            let randomPair = getRandom();
            randomCountry = randomPair.country;
            randomFlag = randomPair.flag;
            besoekt.delete(randomCountry);

            if(besoekt.size == 0){
                showCongratulationsMessage();
                document.getElementById("imageContainer").style.display = "none";
                document.getElementById("titleLabel").style.display = "none";
                document.getElementById("score").style.display = "none";
                return;
            }

            land = randomCountry;
            // When input matches the expected value, replace the image
            let imageContainer = document.getElementById("imageContainer");
            let newImage = document.createElement("img");
            newImage.id = "newImage";
            newImage.src = randomFlag; 
            newImage.alt = "Another Image";

            let newInput = document.createElement("input");
            newInput.type = "text";
            newInput.style.display = "none";
            newInput.placeholder = "Which country";

            // Clear the container and add new elements
            imageContainer.innerHTML = "";
            imageContainer.appendChild(newImage);
            imageContainer.appendChild(newInput);
            const tall = Math.floor(Math.random() * 4) + 1;
            let liste = new Array();

            for (let i = 1; i <= 4; i++) {
            const newButton = document.createElement("button");
            newButton.id = "btn" + i;
            if(i === tall){
                newButton.textContent = land; 
            } else {
                newButton.textContent = getRandomFullListe().country;
                while(liste.includes(newButton.textContent) || newButton.textContent === land){
                    newButton.textContent = getRandomFullListe().country;
                }
                liste.push(newButton.textContent);
            }
            // Add a click event listener to the new button
            newButton.addEventListener("click", knapp);

            // Append the new button to the imageContainer
            imageContainer.appendChild(newButton);
        }

            newInput.addEventListener("focus", () => {
            newInput.style.opacity = 0;
            setTimeout(() => newInput.style.opacity = 1);
            });

            updateScore(true);
            newInput.addEventListener("keydown", handleInput);
        } else {
            wrong.play();
            let randomFlag = "";
            let randomCountry = "";
            let randomPair = getRandom();
            randomCountry = randomPair.country;
            randomFlag = randomPair.flag;
            besoekt.delete(randomCountry);

            if (modul === 0) {
                besoekt = new Map(countryFlagMap);
            } else if (modul === 1) {
                besoekt = new Map(euFlagMap);
            } else if (modul === 2) {
                besoekt = new Map(afFlagMap);
            } else if (modul === 3) {
                besoekt = new Map(asFlagMap);
            } else if (modul === 4) {
                besoekt = new Map(amFlagMap);
            }

            land = randomCountry;
            
            // When input matches the expected value, replace the image
            let imageContainer = document.getElementById("imageContainer");
            let newImage = document.createElement("img");
            newImage.id = "newImage";
            newImage.src = randomFlag; 
            newImage.alt = "Another Image";

            newInput = document.createElement("input");
            newInput.type = "text";
            newInput.style.display = "none";
            newInput.placeholder = "Which country";

            // Clear the container and add new elements
            imageContainer.innerHTML = "";
            imageContainer.appendChild(newImage);
            imageContainer.appendChild(newInput);

            const tall = Math.floor(Math.random() * 4) + 1;
            let liste = new Array();

            for (let i = 1; i <= 4; i++) {
            const newButton = document.createElement("button");
            newButton.id = "btn" + i;
            if(i === tall){
                newButton.textContent = land; 
            } else {
                newButton.textContent = getRandomFullListe().country;
                while(liste.includes(newButton.textContent) || newButton.textContent === land){
                    newButton.textContent = getRandomFullListe().country;
                }
                liste.push(newButton.textContent);
            }
            // Add a click event listener to the new button
            newButton.addEventListener("click", knapp);

            // Append the new button to the imageContainer
            imageContainer.appendChild(newButton);
        }

            newInput.addEventListener("focus", () => {
            newInput.style.opacity = 0;
            setTimeout(() => newInput.style.opacity = 1);
            });

            updateScore(false);
            newInput.addEventListener("keydown", handleInput);
        }
    }


        const muteButton = document.getElementById("muteButton");

        // Create a variable to track the mute status
        let isMuted = false;

        // Function to toggle mute status
        function toggleMute() {
            // Toggle mute status
            isMuted = !isMuted;

            // Mute or unmute audio elements
            if (isMuted) {
                correct.muted = true;
                wrong.muted = true;
                win.muted = true;
                muteImage.src = "sound/mute.png";
            } else {
                correct.muted = false;
                wrong.muted = false;
                win.muted = false;
                muteImage.src = "sound/sound.png";
            }
            muteButton.blur();
        }
        muteButton.addEventListener("click", toggleMute);


        const easy = document.getElementById("easyMode");

        function easyMode(){
            isEasy = !isEasy;
                        // Get all input elements
            const inputElements = document.querySelectorAll("input");
            const buttonElements = document.querySelectorAll("#imageContainer button");
            if(isEasy){const buttonElements = document.querySelectorAll("#imageContainer button");
                for (const inputElement of inputElements) {
                    inputElement.style.display = "none";
                }   
                for (const buttonElement of buttonElements) {
                    buttonElement.style.display = "flex";
            }
            } else {
                for (const inputElement of inputElements) {
                    inputElement.style.display = "flex";
            }
                for (const buttonElement of buttonElements) {
                    buttonElement.style.display = "none";
            }
        }
    }
        easy.addEventListener("click", easyMode);

        </script>
</body>
</html>
